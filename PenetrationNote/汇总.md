# Windows相关

## 账户密码存储位置

```shell
c:\windows\system32\config\SAM   # 非逆转型加密、使用hash值类似的方法、MD5 SHA ;
```

## 日志

> 日志分析

查看哪些主机的日志（筛选对象） ——> 在哪里查看（取 样） ——> 怎么查看（研判分析） ——> 做好记录、保留 关键截图 ——> 上报并处置事件闭环。

> 一般我们主要查看的三类日志是：

应用程序日志、安全日志、系统日志

```sh
常用安全事件ID：
1074  开机关机重启的时间及原因
6005  日志服务的启动
104   日志清除事件
4624  成功登录
4625  登陆失败
4720，4722-4726，4738，4740 用户账号的一系列操作事件
4727，4737，4739，4762 用户组的一系列操作事件
```





# 网络相关

## 常用协议

| 协议                        | 端口  | 层数                 | 作用                                             |
| --------------------------- | ----- | -------------------- | ------------------------------------------------ |
| ARP                         | 无    | 自身3层，但工作在2层 | 地址解析（通过IP地址获取目标设备的MAC地址）      |
| ICMP控制消息协议            | 无    | 3                    | 传递控制信息（指网络通不通等网络本身的消息）ping |
| HTTP超文本传输协议          | 80    | 5                    | HTTP超文本传输                                   |
| HTTPS安全传输协议           | 443   | 5                    | HTTPS安全传输                                    |
| FTP远程文件传输协议         | 20/21 | 5                    | FTP远程文件传输                                  |
| SMTP邮件传输协议            | 25    | 5                    | SMTP邮件传输                                     |
| SSH                         | 22    | 5                    | 远程连接                                         |
| DNS域名解析                 | 53    | 5                    | DNS域名解析                                      |
| DHCP动态主机配置协议        | 67/68 | 5                    | DHCP动态主机配置                                 |
| STP生成树协议               | 无    | 2                    | 防止交换机冗余链路产生的环路                     |
| RIP路由信息协议             | 520   | 3                    | 基于距离向量，在不同的IP网络之间传递路由信息     |
| OSPF开放式最短路径优先协议  | 223   | 3                    |                                                  |
| TCP传输控制协议             | ....  | 5                    |                                                  |
| UDP面向**无连接**传输层协议 | ....  | 5                    |                                                  |

- ARP和ICMP是TCP/IP协议簇的子协议；
- HTTP、HTTPS、FTP 、SSH使用TCP；
- SMTP使用FTP协议；
- DNS一般使用UDP协议，和辅助DNS传输时采用TCP；
- DHCP建立在UDP上；



## OSI七层

| 层           | 作用                                  | 存在        | 协议                                                         |
| :----------- | ------------------------------------- | ----------- | ------------------------------------------------------------ |
| 应用层       | 为应用程序提供网络服务                | 计算机      | HTTP超文本传输80、HTTPS安全传输443、FTP远程文件传输20/21、SMTP邮件传输25、SSH安全外壳22、DNS域名解析53、DHCP动态主机配置67 |
| 表示层       | 数据加密解密（编码解码）              |             |                                                              |
| 会话层       | 管理会话                              |             |                                                              |
| 传输层 段    | 端到端的可靠数据传输服务              | 防火墙      | TCP传输控制 6，UDP用户数据报17                               |
| 网络层包     | Ip地址寻址， 跨网段通信               | 路由器      | ICMP网际控制报文，ARP 地址解析（通过IP地址获取目标设备的MAC地址） |
| 数据链路层帧 | 使用MAC地址来访问介质，解决局域网通信 | 交换机/网卡 | MAC子层协议                                                  |
| 物理层比特   | 在设备之间传输比特流(电信号)          | 网线/网卡   |                                                              |



## TCP/IP五层

TCP**传输控制协议**，IP网际互连协议

- 应用层（合并上三层）： HTTP，FTP,SMTP,DNS
- 传输层： 端到端数据传输服务    ；协议：TCP传输控制，UDP用户数据报
- 网络层： IP地址寻址，跨网段通信， 存在于路由器；IP，ICMP网际控制报文，ARP 地址解析
- 数据链路层：局域网MAC寻址
- 物理层：网卡网线



## 数据封装过程

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240307154416702.png" alt="image-20240307154416702" style="zoom:80%;" />



## 数据帧的传输

通过MAC地址唯一标识网络设备，实现局域网通信。

MAC由俩部分组成，分别是供应商代码和序列号。前24位为代码，由ieee管理分配，后24序列号产商分配。

---

> 传输类型

单播：单一的源端发送到单一目的端，（共享网络中，所有主机都能接收，但由于目标MAC不同，自动丢去帧）

广播：单一的源端发送到共享网络上所有主机 ，目标MAC为 FF  FF FF FF FF FF

组播：选择性广播，主机侦听特定组播地址，接收并处理目的地址为该组播的MAC地址帧；单播第一字节第八位为0，组播为1；



## 交换机转发

> 行为

泛洪：一个端口进来的数据从其他所有端口转发出去；（收到广播帧，或未知目的MAC地址的单播帧）

转发：一个端口进来的数据从另一个端口转发出去；

丢弃：直接丢弃；

> 转发原理

交换机中有一个MAC地址表，里面存放了MAC地址与交换机端口的映射关系，是转发依据；

如果进入交换机的是一个单播帧，则交换机会去查MAC地址表中去查找目的MAC地址，如果查不到则泛洪，查到则比较是否和进入端口MAC相同，相同丢弃，不同转发。

如果进入的是广播帧，则不去查MAC地址表，直接泛洪



## ARP协议

属于网络层，作用是已知IP地址解析MAC地址；

> 工作原理：

1. 首先发送ARP广播，内容是我的IP是xxx，我的MAC是xxx，谁的IP是xxx，MAC地址是什么？
2. 目标主机单播回应ARP；
3. 当pc收到ARP单播回应后，在计算机中生成ARP表





## STP生成数协议

为提高网络可靠性，交互网络一般采用冗余链路，

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240308110449332.png" alt="image-20240308110449332" style="zoom:50%;" />

> **但冗余链路会带来环路危险，导致广播风暴（一直泛洪）以及MAC地址表不稳定（震荡），STP生成树协议可以解决环路问题。**

广播泛洪：在找不到目标MAC时会泛洪，其他交换机找不到再次泛洪，形成环路；

MAC地址震荡：泛洪的时候，交换机收到a端传入的目标MAC地址，形成MAC表，然后从bc端泛洪出去，循环后又从b端进来，会改写一次MAC地址表，环路后会重复改写；

---

> **STP生成树协议作用**

STP用于网络树形拓扑结构的建立，起到防止网络中的冗余链路形成环路;

STP通过阻塞端口来消除环路，并实现链路备份（当主路径故障，激活备用路径）；

> **STP生成数工作过程**

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240308114159706.png" alt="image-20240308114159706" style="zoom:80%;" />

根端口：离根交换机最近的端口；

指定端口：交换机向所连网段发送信息的端口； 根桥所有端口都是指定端口

---

根桥选举：每台交换机都认为自己是根桥并向其他交换机发送BPUD报文，比较桥ID，桥ID由16个比特位的桥优先级和48位MAC组成，优先级越高数值越小越优先，优先级相同MAC地址越小越优先；

根端口选举：选择到根桥路径开销最小的为根端口，端口带宽越高路径开销越小；如果多个累积开销相同，选择发送BID最小的端口；如果BID相同，选择PID最小的；PID由端口优先级和端口号组成，端口优先级0-240，步长16。

指定端口选举：非根交换机依据根路径开销、BID、PID，未被选举的为备用端口，阻塞



## VLAN虚拟局域网技术

传统共享局域网从任意节点发出消息都会被发送到其他节点，形成广播域，若某时刻有多个节点发送消息会造成冲突域；

交换机隔离了冲突域，但广播域问题依然存在；

VLAN技术是将一个物理局域网在逻辑上划分多个广播域。通过在交换机上配置VLAN，可以实现同一个VLAN内的用户可以二层访问，不同VLAN用户二层隔离。避免大范围广播域。

通过Tag（VLAN标签）区分不同VLAN；Tag是一种区分不同VLAN的标记，长度4比特；

> vlan链路

VLAN链路分：Access接入链路（pc和交换机的链路） 和Trunk干道链路（交换机和交换机的链路）；Trunk链路带标签帧，接入链路不带标签；



## IP/掩码/默认网关

> IP：用来标识一个网络节点（任何的联网设备）的互联网地址

A类地址：0-127；前8位网络位，后24位主机位，即网络位.主机位.主机位.主机位

B类地址：128-191；前16位网络位，后16位主机位，即网络位.网络位.主机位.主机位

C类地址：192-223；前24位网络位，后8位主机位，即网络位.网络位.网络位.主机位

D类地址：224-239；组播地址

E类地址：240-255；科研地址

私有地址(不可能出现在公网的地址)：A类：10.0.0.0-10.255.255.255；B类：172.16.0.0-172.31.255.255；C类：192.168.0.0-192.168.255.255

广播：主机位全1

> 子网掩码：用于区分IP地址和网络位与主机位【ip的网络位有几位，掩码就有多少个1，掩码的1代表网络位，0代表主机位】

A类地址：255.0.0.0；网络位.主机位.主机位.主机位；子网掩码可以简写成8

B类地址：255.255.0.0；网络位.网络位..主机位.主机位；子网掩码可以简写成16

C类地址：255.255.255.0；网络位.网络位.网络位.主机位；子网掩码可以简写成24

> 默认网关：从一个网络通向另一个网络的关口

默认网关也是路由器、防火墙、接入服务器接口的IP地址；

相同网段可以直接通信，不需要配置默认网关；



## ICMP控制消息协议

网络层协议，用于在网络设备之间传递各种差错和控制信息，并对于收集网络信息、诊断和排除错误起着重要作用。

差错检测：诊断源和目的地之间的网络连通性；

错误报告：当网络不可达，会发送ICMP不可达报文到发送端；

**最大作用：测试网络连通性和路由追踪**



## 路由转发

路由器和交换机的区别：交换机根据MAC地址表转发，路由器根据路由表转发；

> 路由转发原则

1. 最长匹配原则：多个匹配的网络路由条目，选择掩码最长的条目。（掩码长==ip网络号长）
2. 最小管理距离值：协议优先级（越小优先级越高）
3. 最小度量值：开销（越小带宽越高）

 **当最长匹配原则相同时，再看路由的协议优先级；**





## 跨VLAN 通信1物理连接

> VLAN路由原理

在二层交换机上配置VLAN，每一个VLAN使用一条独占物理链路连接到路由器上；当VLAN间主机需要通信时，数据会经过路由器进行三层路由，并被转发到目的VLAN内的主机上，实现跨VLAN通信。

缺点：每增加一个VLAN，就需要增加一个路由接口，路由接口有限；

## 跨VLAN 通信2单臂路由

> 单臂路由原理

在交换机和路由器之间使用一条Trunk链路连接，允许相关VLAN通过，在路由器上创建子接口，逻辑上把路由器的物理连接分为多条，一个子接口代表一个VLAN的逻辑链路。

---

优点:部署成本低；

缺点：不适用于中大型拓扑；不便于管理；消耗路由cpu；影响数据传输速率；

## 跨VLAN通信3三层交换

> 三层交换原理

为每个VLAN创建一个VLANIF接口作为网关；

在三层交换机上配置VLANIF接口来实现VLAN间路由，如果网络上有多个VLAN，则给每个VLAN配置一个VLANIF接口，并给每个VLANIF接口配置一个IP地址。用户设置的缺省网关就是三层交换机中VLANIF接口的IP地址。



## DHCP动态主机配置协议

解决手动分配地址工作量大，容易地址冲突的问题。

DHCP端口67、68，协议UDP；DNS端口53，协议TCP\UDP；

> DHCP原理

1. 客户端发送DHCP报文来发现DHCP服务器； （谁是DHCP服务器，给我一个ip）
2. DHCP服务器选取一个未分配的IP地址向客户端发送DHCP提供报文；如果存在多给DHCP服务器，所有DHCP服务器都会响应发送；（我是，好的，给你的ip是xxx）
3. 客户端选取收到的第一个DHCP提供报文，并发送DHCP请求报文给DHCP服务器；（就这个IP可以）
4. 收到请求报文后，DHCP服务器发送一个DHCP确认报文；（那好，就这个）
5. 客户端收到确认报文后，会发送ARP报文，检测网络中是否有相同的IP主机，如果没有则使用该IP，如果有则向DHCP服务器发送DHCP拒绝报文，并重新申请IP；

> DHCP租期更新

默认情况，租期达到50%，客户端会更新租约，向DHCP服务器发送请求报文申请延长租期；

> DHCP重绑定

客户端在租期达到87.5%情况下，DHCP服务器还未响应，则客户端认为该DHCP服务器不可用，会申请重新绑定IP；

> IP地址释放

租期到期前都没有收到DHCP服务器响应客户端停止使用IP，重新申请；



## RIP路由信息协议

应用于规模较小、可靠性要求较低的网络； RIP端口号：520

> RIP原理

RIP协议定期向邻居广播整张路由表，以供其他路由学习，这个时间是30秒

RIP是一种距离矢量协议，默认最大支持15跳，第16跳不可达

> 路由环路

由于每个路由器都是以自己为中心，所以广播的时间可能会有所偏差，如ABCD四台路由直连，当D突然故障，C的路由表没有来得及跟新，就被B学习过去，当C学习的时候又会从B学过来，循环学习，会导致路由环流；

> 防护路由环路措施（无需配置，RIP自动解决）

水平分割：水平分隔解决路由环路的发生，从一个接口学习到的路由信息，不再从这个接口发送出去，同时减少了路由更新信息占用的链路带宽；



## OSPF 开放式最短路径优先协议

RIP是基于距离矢量算法的路由协议，存在收敛慢、易产生路由环路、扩展性差，被OSPF代替；

OSPF是基于最短路径优先算法；

> RIP和OSPF

RIP 逐跳收敛，收敛慢，故障恢复时间长。任意链路发生改变，都会经过路由计算、更新路由表、传递下一个路由器的过程；

RIP分布式的路由计算，缺少对全局网络拓扑的了解；

RIP只考虑跳数，不考虑带宽等因素；

OSPF触发式更新与周期泛洪，收敛迅速，故障恢复时间短，任意链路变化，发生变化的路由器会组播声明之间状态，其他路由器自动计算，迅速收敛；

OSPF路由器会学习到全局拓扑信息，独立计算路由；

OSPF将带宽作为选路参考值；

OSPF基于链路状态的路由协议，从设计上就保证了无路由环路，SPF最短路径算法会生成树结构，

---

> OSPF原理

OSPF要求每台运行OSPF的路由器都了解整个网络的链路状态，这样才能计算出到达目的地的最优路径信息。

OSPF收敛过程：链路状态公告LSA泛洪开始，LSA包含路由器已知的接口IP掩码、开销、网络类型等信息，收到LSA的路由根据LSA提供的信息建立自己的链路状态数据库LSDB，并在LSDB的基础上使用SPF算法进行运算，建立到达每个网络的最短路径树。通过最短路径树得出到达目的地的最优路由，加入到路由表。

> OSPF区域

OSPF支持将一组网段组合在一起，这样的组合称为一个区域；

划分区域可以缩小路由器的LSDB规模，减少网络流量；

> OSPF路由器角色

1. 内部路由器IR：指所有所连接的网段都在一个区域与的路由器，属于同一个区域的IR维护相同的链路状态数据库LSDB；
2. 区域边界路由器ABR：指连接到多个区域的路由器，ABR为每个所连接的区域维护一个链路状态数据库LSDB；
3. 骨干路由器BR：指至少有一个端口（或虚连接）连接到骨干区的路由器。包括所有ARB。

---

> OSPF配置

1. 开启OSPF功能，并设置 Routr-ID
2. 选定区域
3. 声明网段



## 传输层协议TDP

> TCP-传输控制协议

TCP面向连接（三握四挥），提供可靠的数据传输服务；

TCP使用IP作为网络层协议，这时TCP数据段被封装在IP数据包里。TCP数据段由头部和数据组成，头部最多60个字节，正常20；

TCP行为：建立连接、数据传输、流量控制、断开连接；

> TCP头部字段

1. 源端口号：源主机应用程序的端口号；
2. 目的端口号：目的主机的由于现场的端口号；
3. 序列号：用于标识从发送端发出不同TCP数据段的编号；
4. 确认序列号：标识接收端确认收到的数据段，确认序列号为成功收到的序列+1；
5. 头部长度：表示头部占用的字节数；
6. 窗口大小：表示接收端期望通过单次确认而收到的数据的大小；
7. 效验码：效验整个TCP报文，由发生端记录，接收端验证；

---

> TCP标志位

1. URG:紧急指针，马上处理；
2. ACK: 表示应答域有效（确认请求），1有效，0无效；
3. PSH:将数据推送到应用层； 
4. RST:强制断开连接；
5. SYN:请求建立连接；
6. FIN:请求断开连接；

---

> TCP建立连接 三握

1. 客户端发送SYN数据段，表示请求建立连接，此数据段编号为a；（我要和你连接）
2. 服务器回复SYN+ACK数据段，此数据段编号b，确认数列号为a+1；（收到，我也想和你连接）
3. 客户端发送ACK数据段，此数据段序列号a+1；确认序列号为b+1；（收到，连接）

---

> TCP 数据传输

TCP使用了确认技术来确保目的设备收到源数据；提高了可靠性

确认技术工作原理：目的设备接收到源设备发送的数据段，会向源数据发送确认报文，源设备收到确认报文后，继续发送数据段；

![image-20240312114056725](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240312114056725.png)

主机A向服务器A发送TCP数据段，当服务器A成功收到M+1499及以前的数据时，会以M+1499+1=M+1500来进行确认。当M+1500的数据段传输失败后，服务器会继续向客户端发送M+1500进行确认。

---

> TCP流量控制

TCP滑动窗口技术通过改变窗口大小来实现端到端之间的数据传输进行流量控制

![image-20240312114824778](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240312114824778.png)

主机A向服务器A发送4个长度为1024的字节数据段，其中主机窗口的大小为4096.服务器收到第三个数据段后，缓存区满了，第四个数据被丢弃。服务器以ACK 3073响应，窗口大小调整为3072，表明服务器缓存区只能存3072字节数据段，于是主机A改变发送速率。

---

> TCP断开连接-四挥

TCP是全双工模式传输数据，意味着TCP三次挥手建立的实际上是两个方向的连接，同一时刻两个方向都可以进行数据传输。因此在传输完毕后，两个方向的连接都需要关闭；

![image-20240312115426610](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240312115426610.png)

主机A向服务器A发送FIN请求关闭连接，ACK数据段序列号a，确认序列号b；（我要和你断开）

服务器A回应ACK数据段，序列号b，确认序列号a+1； （收到，断吧）

服务器A向主机A发送FIN请求关闭连接，ACK数据段序列号b，确认序列号a+1； （我也要和你断开连接）

服主机A回应ACK数据段，序列号a+1，确认序列号b+1； （收到，断吧）



## 传输层协议UDP

UDP是一种面向**无连接**的传输层协议，传输可靠性没有保证；当应用程序对传输的文件可靠性要求不高，但是对传输速率和延迟要求较高时，可以采用UDP在传输层控制数据的转发。UDP将数据从源端发送到目的端时，无需事先建立连接，也没有使用TCP的确认技术或滑动窗口机制，因此UDP不能保证数据传输的可靠性；

UDP报文分为UDP报文头部和UDP数据区域；

> UDP头部

UDP头部占8字节，传输数据没有确认机制，适用于实时数据传输，如语言、视频通话。传输速率高、开销小；

> UDP头部字段

源端口号：源主机应用程序端口号

目的端口号：目的主机应用程序端口号

UDP长度：UDP头部和UDP数据的字节长度之和

效验和：效验功能，可选；

---

> UDP传输过程

主机A发送数据包时，这些数据包是以有序方式独立的发送到网络，所以不同的数据包可能以不同的网络路径到达主机B。这样情况下，先发的数据包不一定先到达，因为UDP数据包没有序号，所以主机B也没有办法将数据包按顺序重新组合，此时需要应用程序提供报文的到达确认、排序和流量控制等功能。

UDP不提供重传机制，占用资源小、处理效率高。



## 访问控制ACL

访问控制列表ACL可以定义一系列不同的规则，设备根据这些规则对数据包进行分类，并针对不同类型的报文进行不同的处理，从而实现对网络访问行为的控制、限制网络流量、提高网络性能、防止网络攻击。

> ACL原理

ACL是一种包过滤技术，基于数据包中的IP地址、端口号来进行过滤。

> ACL分类

基本ACL： 编号范围2000-2999  参数是源IP地址；

高级ACL：编号范围3000-3999 参数是源IP地址、目标IP地址、源端口、目标端口等；

二层ACL：编号范围4000-4999 参数是源MAC地址、目标MAC地址、以太帧协议类型等；

---

> ACL规则匹配

每个ACL包含多个规则，路由器根据规则来对流量数据进行过滤，设备收到数据流量后，会逐条匹配ACL规则，查看其是否匹配，如果不匹配，则匹配下一条。一旦找到匹配的规则，则执行规则中定义的动作，且不再与后续规则匹配。如果找不到，则不进行任何处理；

 ACL中定义的规则可能存在重复或矛盾，ACL通过设置规则优先级来处理规则之间的重复或矛盾情形；

配置顺序按照ACL编号（rule-id）从小到大顺序进行匹配。设备会在创建ACL的过程中自动为每个规则分配一个编号，规则编号决定匹配顺序。路由器默认编号的步长为5，通过设置步长使规则之间留有空隙，便于后续插入新规则。

自动排序使用深度优先原则进行匹配，即根据规则的精确度排序；ACL默认的隐藏规则是允许所有；



## 网络地址转换NAT

网络地址转换技术NAT：将内网地址转换为外网地址，多个内网用户可以公用一个外网地址，以解决IPV4地址不足的问题；

---

> NAT工作原理

NAT是将IP数据报文头部中的IP地址转换为另一个IP地址的过程，NAT一般部署在边界设备上，当收到的报文源IP为私网，目的为公网时，会将源私网转换为一个公网地址，这样目的公网就能收到并响应，此外网关上还会创建一个NAT映射表，以便判断接收到的报文应该发往哪个私网IP；

---

> NAT种类

| NAT种类              | 具体技术                        | 应用场景                   |
| -------------------- | ------------------------------- | -------------------------- |
| SNAT（源地址转换）   | 静态NAT、动态NAT、NAPT、Easy IP | 内网用户共享公网IP地址上网 |
| DNAT（目的地址转换） |                                 | 外网用户能访问内网服务器   |

> 静态NAT技术

静态NAT基于公私ip一对一映射实现公私转换，执行静态地址转换，发出时转换私有地址为公网地址，接收时根据映射表转换公网地址为私网地址

> 动态NAT基于地址池实现公私转换

发出时，网关从配置的公网地址池选择未使用的公网地址与私网地址映射，每台主机都会分配唯一的公网地址，不使用时会删除映射，接收时，根据映射进行公私转换；动态地址池用尽就只能等待释放，后续主机才能再使用

> 网络地址端口转换NAPT

NAPT核心思想：端口复用技术

NAPT条目默认存在60s，只有在内到外才会生成NAT地址表；

发出时从配置的公网地址池选择空闲的公网地址和端口号，建立NAPT映射表，指定私网ip和带端口与公网ip和端口的映射，接收时再转回来；

> Esay IP

Esay IP允许将多个私网地址映射到网关出接口的不同端口。适用于小规模局域网，如办公室等主机不多的地方，与NAPT原理基本相同，但Esay IP无需手动创建公网地址池，可以通过拨号获得临时公网IP；

> 目的地址转换DNAT

需要配置服务器私网IP和端口并发布到路由器。路由器在接收公网主机请求报文后，根据报文的目的的地址和端口号查询表项，根据查询到的地址将公网报文的目标地址转换为私网地址和端口，并转发到私网服务器；发出时根据表项再将报文的源ip地址转换为公网ip；



## 虚拟专用网络

广域网数据传输面临的安全隐患：数据传输会被窃听、篡改、通信双方被冒充；（机密性、完整性、身份认证）

解决办法：专线、独享（安全、稳定、高效）；--VPN虚拟专用网络

VPN虚拟网络：是在现有的公网（不安全链路）上，通过封装，构建出一条虚拟的，逻辑上的专用链路；

VPN实现：使用加密技术防止窃听、数据完整性验证防止篡改、认证技术确认身份；

VPN分类：点到点VPN、远程访问VPN 

----

> 点到点VPN

一般用在企业到企业，在两家公司的总出口设备建立VPN通道；

代表技术：IPsec VPN；

IPsec VPN大致思路：将异地的公司内网合并成一个大的内网，私有地址可以直接通信，但数据是在公网上跑；

---

> 远程访问VPN -RA VPN

一般用在个人到企业，公司部署VPN，员工通过拨号连接；

常见远程访问VPN协议：PPTP VPN、L2TP VPN、SSL VPN、EASY VPN；



## 防火墙

防火墙是一款具有安全防护功能的网络设备。作用是访问控制，隔离网络，将需要保护的网络和不安全网络隔离开。

---

> 防火墙和路由器区别

- 防火墙是4-5层设备，路由器是3层设备；
- 防火墙隔离的是网络，路由器隔离的是广播和网段；
- 防火墙具有路由器的转发功能，还能做区域隔离、访问控制策略；
- 路由器ACL是限制规则，防火墙策略是放行规则；

> 防火墙分类（防火墙原理-包过滤、应用代理、状态检测）

**形态上分：软件防火墙、硬件防火墙；**

**技术上分：包过滤防火墙、应用代理防火墙、状态检测防火墙、web服务防火墙、应用防火墙；**

- 包过滤防火墙：最早的防火墙技术，基本淘汰。功能简单配置复杂，查看IP包头基于源目IP和端口，不能识别回包；
- 应用代理防火墙：最早的防火墙技术，安全性高，连接效率低，速度慢，配置复杂，工作第五层；应用代理防火墙代理通信双方身份，过滤时对数据依次解封装，再依次封装。回包相同；
- 状态检测防火墙：主流防火墙，速度快效率高，功能强配置简单；状态检测防火墙先检查预先设置的安全规则，允许符合的通过，并在内存中记录该连接的相关信息，生成状态表，对该连接的后续数据包不再匹配规则，符合状态表直接通过。回包相同；
- web服务防火墙：只适合部署在web服务器外围，为web流量做检查
- 应用防火墙：是一个发展趋势

---

> 防火墙性能指标

![image-20240314173117673](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240314173117673.png)

> 防火墙部署方式

部署方式：透明模式、路由模式、混杂模式；

---

- 透明模式：（桥模式、交换模式）防火墙相当于交换机，将网络划分为三区域，且都在同一网段；使用场景一般是网络已经架设完毕，网络功能已经基本实现，想要后加防火墙且不影响现有的稳定的网络；为二层端口；
- 路由模式：（NAT模式、网关模式）相当于路由器，将网络分为三个不同网段的区域；防火墙开启路由功能，对公司原有架构产生改变；使用场景公司网络正在架设；为三层端口；
- 混杂模式：少见；

# 数据库

## 元数据库information_schema

![image-20240318132423487](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240318132423487.png)

> 查询所有数据库名

```mysql
select schema_name from information_schema.schemata;
```

> 查询某一数据库下的表名

```mysql
select table_name from information_schema.tables where table_schema="数据库名";
```

> 查询某一数据库中某一表的字段名

```mysql
select column_name from information_schema.columns where ctable_schema="数据库名" and table_name="表名";
```







# Linux

## Linux目录

![image-20240315134011383](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240315134011383.png)

![image-20240315134023481](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240315134023481.png)

## 用户信息文件passwd



![image-20240315180041483](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240315180041483.png)

```txt
root：用户名；

x：密码占位符，x代表有密码，无内容代表没密码；

0：UID，身份标识，0是超管；

0：GID，用户组id；

root：身份信息；

/root：用户家目录；

/bin/bash :用户命令解释器，sbin/nologin 不允许登录；
```

## 用户密码文件shadow

![image-20240315180939984](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240315180939984.png)

每一行记录一个用户的密码信息，以`:`作为分隔符，一共9段内容；

```txt
用户名：密码密文：密码修改时间戳：密码最短有效期：密码最长有效期:密码过期时间:密码不活跃期:账户失效期:未分配功能
```

## 日志

> 日志分类：内核及系统日志、用户日志、程序日志

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240317104525767.png" alt="image-20240317104525767" style="zoom:80%;" />

---

> 日志级别

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240317105331068.png" alt="image-20240317105331068" style="zoom:80%;" />



## iptables包过滤防火墙

表的作用就是容纳各种规则链

![image-20240319181521523](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240319181521523.png)

规则链的作用就是对数据包进行过滤或处理，链中可以容纳各种防护墙规则，根据处理数据包的不同时机

![image-20240319181551428](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240319181551428.png)

![image-20240319181603004](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240319181603004.png)

> 语法

iptables 操作哪个张表，哪个链，符合什么流量，执行什么动作，

```sh
iptables  -t  表名  选项  [数字]  链名  [匹配条件]  [-j 控制类型]。

#选项：-A尾部追加 -I 开头或指定序号添加 -D删除链内指定序号规则 -F删除链内所有规则
#控制类型：ACCEPT 允许；DROP 拒绝； REJECT 拒绝并提示; LOG 记录日志并传给下一个规则；
```

- 不指定表名时，默认指filter 表；
- 不指定链名时，默认值表内所有链；
- 不指定序号的时，默认第一条规则；
- 从上到下，依次匹配；
- 如果匹配到了规则，立即执行动作（控制类型），结束匹配；

```sh
iptables -t filter -I INPUT -p icmp -j REJECT  #禁ping本机
iptables -t filter -I FORWARD -j ACCEPT #开启转发
iptables -A FORWARD ! -p icmp -j ACCEPT # ! 标识条件取反
iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP # 阻止192.168.0.0/16通过外网接口eth1 
iptables -A FORWARD -s 192.168.4.0/24 -p udp --dport 53 -j ACCEPT #允许来自ip：53 协议udp的通过(DNS)

#只允许网关ping别人，不允许反ping
iptables -t filter -I INPUT -p icmp --icmp-type 8 -j DROP #8是别人发起的请求
iptables -t filter -I INPUT -p icmp --icmp-type 0 -j ACCEPT #
iptables -t filter -I INPUT -p icmp --icmp-type 3 -j ACCEPT #
```

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240319183115344.png" alt="image-20240319183115344" style="zoom:80%;" />

> 导出备份规则

```sh
iptables-save > /opt/iprules_all.txt
```

> 导入

```sh
iptables-restore < /opt/iprules_all.txt
```

> SNAT 策略

```sh
#静态
iptables -t nat -I POSTROUTING -p all -o ens35 -j SNAT --to-source 10.10.10.21

#动态
iptables -t nat -I POSTROUTING -o ens35 -j MASQUERADE
```

> DNAT 策略

```sh
iptables -t nat -I PREROUTING -d 10.10.10.21 -i ens35 -p tcp --dport 8088 -j DNAT --to-destination
172.16.2.100:80
#将172.16.2.100:80 映射到对外接口10.10.10.21:8088
```



## 计划任务

```sh
at now +1 min
at> echo "My Name is ROOT" > /tmp/root
at> <EOT> 
# 1分钟后执行
```

