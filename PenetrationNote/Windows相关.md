# ####################################



# 1.服务器远程管理

## 1.1远程桌面连接方法

> **方法一** 

- 远程桌面通信协议（Remote Desktop Protocol） 
- 远程桌面连接（Remote Desktop Connection）
-  通过远程桌面功能实时地操作远程计算机 

> **方法二** 

- 终端服务网页访问（Terminal Services Web Access） 
- 远程桌面页面连接（Remote Desktop Web Connection） 
- 通过浏览器连接远程计算机

---

> **修改远程桌面端口**【远程桌面连接的默认端口号为 3389. 不安全】

1.在远程计算机上运行 regedit.exe 程序

2.更改路径：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Ter minal Server\WinStations\RDP-Tcp\PortNumber

3.重启

4.在 Windows 防火墙内启用这个新的端口

5. 客户端计算机在连接远程计算机时，必须加入新的连接端口号 【ip：端口号】

---

> **使用命令行参数控制远程桌面连接的外观和行为**

```shell
mstsc [<connection file>] [/v:<server[:port]>]
		[/admin] [/f[ullscreen]]
		[/w:<width>] [/h:<height>]
		[/public] | [/span]
		[/edit "connection file"] [/migrate] [/?]
```

![image-20240305161919359](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305161919359.png)

---

## 1.2 VNC远程连接【内网】

虚拟网络计算机（Virtual Network Computing ）是一种屏幕画面分享及远程操作软件。使用远程帧缓冲（Remote Frame Buffer，RFB）协议

---

> **组成**  

- 客户端： VNC Viewer  【连接方】
- 服务端： VNC Server   【被连接方】

> **特点**

- 平台无关性  
- 可使用浏览器 
-  广泛的用户群

---



## 1.3 配置网络参数

```sh
#查看网卡所有配置
ipconfig /all

#设置静态IPV4参数
netsh interface ip set address "[网络适配器名称]" static 192.168.100.10 255.255.255.0 192.168.100.2

#设置DNS服务器地址
netsh interface ip set dnsserver "[接口名称]" static 8.8.8.8

#设置IPV4 动态
netsh interface ip set address "[网络适配器名称]" dhcp 

```





# 2.用户与组管理

> 用户管理

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305172652096.png" alt="image-20240305172652096" style="zoom:50%;" />

> 组管理

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305172720298.png" alt="image-20240305172720298" style="zoom:50%;" />



# 3.Windows系统密码

使用环境：工作中忘记了一台服务器的开机密码

---

## 3.1 五次shift漏洞 【已修复】

> **漏洞概述**

+ 在未登录系统时，连续按5次shift键，弹出程序c:\windows\system32\sethc.exe 
+ 部分win7及win10系统在未进入系统时，可以通过系统修复漏洞篡改系统文件名！ 
+ 注：如win7或win10系统已修补漏洞，则无法利用 

> **破解漏洞相关知识**

+ cmd工具路径 

​    c:\windows\system32\cmd 

+ 用户/账户密码存储位置 

c:\windows\system32\config\SAM         # 非逆转型加密、使用hash值类似的方法、MD5 SHA 

+ 修改账户密码： 

net user 用户名 新密码 

> **漏洞利用过程**

+ 案例：破解win7系统密码 

实验步骤： 

1、开启win7虚拟机，开机，并设置一个复杂密码； 

2、关机，并开机，在出现windows启动界面时强制关机； 

3、再开机，出现“启动修复（推荐）”及选择该项； # 如为未现，多尝试几次第2步

4、出现系统还原提示，点击取消，等待几分钟后，会出现问题原因，点击查看详细信息； 

5、打开最后一个链接即一个记事本； 

6、记事本中点打开，并选择显示所有文件； c盘——windows目录——System32

7、找到sethc并改名sethc-bak，再找到cmd，复制一份cmd改名为sethc 

8、全部关闭，重启。 

9、系统启动完毕后，连续按5次shift键，将弹出cmd工具，使用命令net user 用户名 新密码，将当前用户密码修 

改掉即可，或者另外建立1个用户，并提升为管理员，注销后，可再删除新建的用户，这样的好处为不修改当前用户的密码即可登录系统



## 3.2 PE系统破解

> 密码的储存位置

- 账户密码存储位置：c:\windows\system32\config\SAM        
- sam文件受系统保护 administrator权限不够
- system

Hash  哈希。这个加密函数对一个任意长度的字符串数据进行一次加密函数运算，然后返回一个固定长度的字符串。Hash主要用于信息安全领域中加密算法，渗透测试中获取目标系统的明文或Hash往往是整个渗透测试过程中重要的一环。

暴力破解/撞库

- windows系统上，默认密码最长有效期42天

> **漏洞概述**

+ PE系统，独立于硬盘系统的微型系统，通过PE系统启动可以对系统的SAM文件做修改。

> **破解漏洞相关知识**

+ 账户密码存储文件：c:\windows\system32\config\SAM 

+ U盘引导系统：开机修改启动顺序，并将U盘设置为第一启动顺序！（一般电脑是开机马上按F2键，进入BIOS，修改启动顺序，不同品牌电脑设置方法不一样）

> **漏洞利用过程**

1.下载PE制作工具（如老毛桃，大白菜，深度等），插入空U盘或光盘，一键制作PE系统到U盘 

2.为XP系统设置一个复杂密码，并关机。 

3.插入带有PE系统的U盘或光盘，开机，马上按F2/多次按f2，进入BIOS，设置启动顺序为U盘或光盘为第一位，保存 



4.重启，进入PE菜单或PE系统，使用破解密码程序进行破解。（不同的PE系统菜单不一样，但一般都有破解密码选项）



## 3.3Mimikatz

当前administrator且必须是登录状态，还得免杀技术。

注：在安装了KB2871997补丁或者系统版本大于windows server 2012时，系统的内存中就不再保存明文的密码，这样利用mimikatz就不能从内存中读出明文密码了。mimikatz的使用需要administrator用户执行，administrators中的其他用户都不行。

----

步骤一：

cmd中输入【修改注册表，意为存储明文】

```shell
reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f 
```

步骤二：

运行猕猴桃mimikatz 【输入】

```shell
#提升权限 
privilege::debug 

#抓取密码 
sekurlsa::logonpasswords
```

重启或用户重新登录后可以成功抓取

---



# ###################################

# 4.文件共享服务器

## 4.1 安装文件共享服务器

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305201632485.png" alt="image-20240305201632485" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305201707419.png" alt="image-20240305201707419" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305201748375.png" alt="image-20240305201748375" style="zoom:80%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305202824794.png" alt="image-20240305202824794" style="zoom:80%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305202841610.png" alt="image-20240305202841610" style="zoom:50%;" />

## 4.2 设置共享文件夹

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305204148942.png" alt="image-20240305204148942" style="zoom:50%;" />



## 4.3 设置网络共享

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305204420417.png" alt="image-20240305204420417" style="zoom:50%;" />

访问：

```txt
\\192.168.100.10\hello
```





## 4.4配置共享文件权限

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305205219950.png" alt="image-20240305205219950" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305205304569.png" alt="image-20240305205304569" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305205319035.png" alt="image-20240305205319035" style="zoom:50%;" />



## 4.5 共享隐藏文件

在共享名后添加“$”

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305210302047.png" alt="image-20240305210302047" style="zoom:50%;" />

访问方法

```txt
\\192.168.100.10\新建文件夹$
```

---

# ###################################

# 5.Web服务

1. 了解IIS的主要功能
2. 掌握IIS的安装和配置

---

## 5.1 安装 IIS

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305210844149.png" alt="image-20240305210844149" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305211007423.png" alt="image-20240305211007423" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305211116764.png" alt="image-20240305211116764" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305211131691.png" alt="image-20240305211131691" style="zoom:50%;" />



## 5.2 配置IIS

![image-20240305211827925](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305211827925.png)

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305211951851.png" alt="image-20240305211951851" style="zoom:50%;" />



# 6. DHCP服务

为网络中计算机自动分配TCP/IP参数的协议

DHCP提供的TCP/IP配置 ：• IP地址   • 子网掩码   • 网关   • DNS

---

> DHCP要求：服务器具有静态IP地址

1. 确定DHCP服务器分发给客户机的IP地址范围
2. 为客户机确定正确的子网掩码
3. 确定DHCP服务器不向客户机分发的IP地址
4. 决定IP地址的租用期限

---

## 6.1安装DHCP

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305220156278.png" alt="image-20240305220156278" style="zoom:50%;" />

## 6.2 配置DHCP

![image-20240305221937431](https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305221937431.png)



<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222158075.png" alt="image-20240305222158075" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222324478.png" alt="image-20240305222324478" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222435620.png" alt="image-20240305222435620" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222633424.png" alt="image-20240305222633424" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222735170.png" alt="image-20240305222735170" style="zoom:50%;" />



<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222843736.png" alt="image-20240305222843736" style="zoom:50%;" />

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240305222909219.png" alt="image-20240305222909219" style="zoom:50%;" />

配置结束



# 7.DNS服务











# 8. FTP服务

默认两个端口， 20端口提供验证用户密码，  21端口传输数据





# ####################################

# 9.日志

> **日志路径**

```txt
应用程序日志  %SystemRoot%\System32\Winevt\Logs\Application.evtx

安全日志
%SystemRoot%\System32\Winevt\Logs\Security.evtx

系统日志
%SystemRoot%\System32\Winevt\Logs\System.evtx
```

<img src="C:/Users/admin/AppData/Roaming/Typora/typora-user-images/image-20240306134727019.png" alt="image-20240306134727019" style="zoom:50%;" />

> **日志分析**

首先我们需要有一个清晰的思路： 

查看哪些主机的日志（筛选对象） ——> 在哪里查看（取 样） ——> 怎么查看（研判分析） ——> 做好记录、保留 关键截图 ——> 上报并处置事件闭环。

---

## 9.1 事件ID

```txt
Win+R打开运行，输入“eventvwr.msc”，回车运行，打开“事件查看器”；或者右键我的电脑-管理-系统工具-事件查看器。在事件查看器中右键单击系统或安全日志，选择筛选当前日志，在筛选器中输入下列事件ID即可。
------------------------------------------------------
常用安全事件ID:
系统：
1074，通过这个事件ID查看计算机的开机、关机、重启的时间以及原因和注释。
6005，表示计算机日志服务已启动，如果出现了事件ID为6005，则表示这天正常启动了系统。
104，这个时间ID记录所有审计日志清除事件，当有日志被清除时，出现此事件ID。
安全：
4624，这个事件ID表示成功登陆的用户，用来筛选该系统的用户登陆成功情况。
4625，这个事件ID表示登陆失败的用户。
4720,4722,4723,4724,4725,4726,4738,4740,事件ID表示当用户帐号发生创建，删除，改变密码时的事件记录。
4727,4737,4739,4762,事件ID表示当用户组发生添加、删除时或组内添加成员时生成该事件。
————————————————

EVENT_ID	           安全事件信息
1100	-----      事件记录服务已关闭
1101	-----      审计事件已被运输中断。
1102	-----      审核日志已清除
1104	-----      安全日志现已满
1105	-----      事件日志自动备份
1108	-----      事件日志记录服务遇到错误
4608	-----      Windows正在启动
4609	-----      Windows正在关闭
4610	-----      本地安全机构已加载身份验证包
4611	-----      已向本地安全机构注册了受信任的登录进程
4612	-----      为审计消息排队分配的内部资源已经用尽，导致一些审计丢失。
4614	-----      安全帐户管理器已加载通知包。
4615	-----      LPC端口使用无效
4616	-----      系统时间已更改。
4618	-----      已发生受监视的安全事件模式
4621	-----      管理员从CrashOnAuditFail恢复了系统
4622	-----      本地安全机构已加载安全包。
4624	-----      帐户已成功登录
4625	-----      帐户无法登录
4626	-----      用户/设备声明信息
4627	-----      集团会员信息。
4634	-----      帐户已注销
4646	-----      IKE DoS防护模式已启动
4647	-----      用户启动了注销
4648	-----      使用显式凭据尝试登录
4649	-----      检测到重播攻击
4650	-----      建立了IPsec主模式安全关联
4651	-----      建立了IPsec主模式安全关联
4652	-----      IPsec主模式协商失败
4653	-----      IPsec主模式协商失败
4654	-----      IPsec快速模式协商失败
4655	-----      IPsec主模式安全关联已结束
4656	-----      请求了对象的句柄
4657	-----      注册表值已修改
4658	-----      对象的句柄已关闭
4659	-----      请求删除对象的句柄
4660	-----      对象已删除
4661	-----      请求了对象的句柄
4662	-----      对对象执行了操作
4663	-----      尝试访问对象
4664	-----      试图创建一个硬链接
4665	-----      尝试创建应用程序客户端上下文。
4666	-----      应用程序尝试了一个操作
4667	-----      应用程序客户端上下文已删除
4668	-----      应用程序已初始化
4670	-----      对象的权限已更改
4671	-----      应用程序试图通过TBS访问被阻止的序号
4672	-----      分配给新登录的特权
4673	-----      特权服务被召唤
4674	-----      尝试对特权对象执行操作
4675	-----      SID被过滤掉了
4688	-----      已经创建了一个新流程
4689	-----      一个过程已经退出
4690	-----      尝试复制对象的句柄
4691	-----      请求间接访问对象
4692	-----      尝试备份数据保护主密钥
4693	-----      尝试恢复数据保护主密钥
4694	-----      试图保护可审计的受保护数据
4695	-----      尝试不受保护的可审计受保护数据
4696	-----      主要令牌已分配给进程
4697	-----      系统中安装了一项服务
4698	-----      已创建计划任务
4699	-----      计划任务已删除
4700	-----      已启用计划任务
4701	-----      计划任务已禁用
4702	-----      计划任务已更新
4703	-----      令牌权已经调整
4704	-----      已分配用户权限
4705	-----      用户权限已被删除
4706	-----      为域创建了新的信任
4707	-----      已删除对域的信任
4709	-----      IPsec服务已启动
4710	-----      IPsec服务已禁用
4711	-----      PAStore引擎（1％）
4712	-----      IPsec服务遇到了潜在的严重故障
4713	-----      Kerberos策略已更改
4714	-----      加密数据恢复策略已更改
4715	-----      对象的审核策略（SACL）已更改
4716	-----      可信域信息已被修改
4717	-----      系统安全访问权限已授予帐户
4718	-----      系统安全访问已从帐户中删除
4719	-----      系统审核策略已更改
4720	-----      已创建用户帐户
4722	-----      用户帐户已启用
4723	-----      尝试更改帐户的密码
4724	-----      尝试重置帐户密码
4725	-----      用户帐户已被禁用
4726	-----      用户帐户已删除
4727	-----      已创建启用安全性的全局组
4728	-----      已将成员添加到启用安全性的全局组中
4729	-----      成员已从启用安全性的全局组中删除
4730	-----      已删除启用安全性的全局组
4731	-----      已创建启用安全性的本地组
4732	-----      已将成员添加到启用安全性的本地组
4733	-----      成员已从启用安全性的本地组中删除
4734	-----      已删除已启用安全性的本地组
4735	-----      已启用安全性的本地组已更改
4737	-----      启用安全性的全局组已更改
4738	-----      用户帐户已更改
4739	-----      域策略已更改
4740	-----      用户帐户已被锁定
4741	-----      已创建计算机帐户
4742	-----      计算机帐户已更改
4743	-----      计算机帐户已删除
4744	-----      已创建禁用安全性的本地组
4745	-----      已禁用安全性的本地组已更改
4746	-----      已将成员添加到已禁用安全性的本地组
4747	-----      已从安全性已禁用的本地组中删除成员
4748	-----      已删除安全性已禁用的本地组
4749	-----      已创建一个禁用安全性的全局组
4750	-----      已禁用安全性的全局组已更改
4751	-----      已将成员添加到已禁用安全性的全局组中
4752	-----      成员已从禁用安全性的全局组中删除
4753	-----      已删除安全性已禁用的全局组
4754	-----      已创建启用安全性的通用组
4755	-----      启用安全性的通用组已更改
4756	-----      已将成员添加到启用安全性的通用组中
4757	-----      成员已从启用安全性的通用组中删除
4758	-----      已删除启用安全性的通用组
4759	-----      创建了一个安全禁用的通用组
4760	-----      安全性已禁用的通用组已更改
4761	-----      已将成员添加到已禁用安全性的通用组中
4762	-----      成员已从禁用安全性的通用组中删除
4763	-----      已删除安全性已禁用的通用组
4764	-----      组类型已更改
4765	-----      SID历史记录已添加到帐户中
4766	-----      尝试将SID历史记录添加到帐户失败
4767	-----      用户帐户已解锁
4768	-----      请求了Kerberos身份验证票证（TGT）
4769	-----      请求了Kerberos服务票证
4770	-----      更新了Kerberos服务票证
4771	-----      Kerberos预身份验证失败
4772	-----      Kerberos身份验证票证请求失败
4773	-----      Kerberos服务票证请求失败
4774	-----      已映射帐户以进行登录
4775	-----      无法映射帐户以进行登录
4776	-----      域控制器尝试验证帐户的凭据
4777	-----      域控制器无法验证帐户的凭据
4778	-----      会话重新连接到Window Station
4779	-----      会话已与Window   Station断开连接
4780	-----      ACL是在作为管理员组成员的帐户上设置的
4781	-----      帐户名称已更改
4782	-----      密码哈希帐户被访问
4783	-----      创建了一个基本应用程序组
4784	-----      基本应用程序组已更改
4785	-----      成员已添加到基本应用程序组
4786	-----      成员已从基本应用程序组中删除
4787	-----      非成员已添加到基本应用程序组
4788	-----      从基本应用程序组中删除了非成员。
4789	-----      基本应用程序组已删除
4790	-----      已创建LDAP查询组
4791	-----      基本应用程序组已更改
4792	-----      LDAP查询组已删除
4793	-----      密码策略检查API已被调用
4794	-----      尝试设置目录服务还原模式管理员密码
4797	-----      试图查询帐户是否存在空白密码
4798	-----      枚举了用户的本地组成员身份。
4799	-----      已枚举启用安全性的本地组成员身份
4800	-----      工作站已锁定
4801	-----      工作站已解锁
4802	-----      屏幕保护程序被调用
4803	-----      屏幕保护程序被解雇了
4816	-----      RPC在解密传入消息时检测到完整性违规
4817	-----      对象的审核设置已更改。
4818	-----      建议的中央访问策略不授予与当前中央访问策略相同的访问权限
4819	-----      计算机上的中央访问策略已更改
4820	-----      Kerberos票证授予票证（TGT）被拒绝，因为该设备不符合访问控制限制
4821	-----      Kerberos服务票证被拒绝，因为用户，设备或两者都不符合访问控制限制
4822	-----      NTLM身份验证失败，因为该帐户是受保护用户组的成员
4823	-----      NTLM身份验证失败，因为需要访问控制限制
4824	-----      使用DES或RC4进行Kerberos预身份验证失败，因为该帐户是受保护用户组的成员
4825	-----      用户被拒绝访问远程桌面。默认情况下，仅当用户是Remote
                   Desktop Users组或Administrators组的成员时才允许用户进行连接
4826	-----      加载引导配置数据
4830	-----      SID历史记录已从帐户中删除
4864	-----      检测到名称空间冲突
4865	-----      添加了受信任的林信息条目
4866	-----      已删除受信任的林信息条目
4867	-----      已修改受信任的林信息条目
4868	-----      证书管理器拒绝了挂起的证书请求
4869	-----      证书服务收到重新提交的证书请求
4870	-----      证书服务撤销了证书
4871	-----      证书服务收到发布证书吊销列表（CRL）的请求
4872	-----      证书服务发布证书吊销列表（CRL）
4873	-----      证书申请延期已更改
4874	-----      一个或多个证书请求属性已更改。
4875	-----      证书服务收到关闭请求
4876	-----      证书服务备份已启动
4877	-----      证书服务备份已完成
4878	-----      证书服务还原已开始
4879	-----      证书服务恢复已完成
4880	-----      证书服务已启动
4881	-----      证书服务已停止
4882	-----      证书服务的安全权限已更改
4883	-----      证书服务检索到存档密钥
4884	-----      证书服务将证书导入其数据库
4885	-----      证书服务的审核筛选器已更改
4886	-----      证书服务收到证书请求
4887	-----      证书服务批准了证书请求并颁发了证书
4888	-----      证书服务拒绝了证书请求
4889	-----      证书服务将证书请求的状态设置为挂起
4890	-----      证书服务的证书管理器设置已更改。
4891	-----      证书服务中的配置条目已更改
4892	-----      证书服务的属性已更改
4893	-----      证书服务存档密钥
4894	-----      证书服务导入并存档了一个密钥
4895	-----      证书服务将CA证书发布到Active Directory域服务
4896	-----      已从证书数据库中删除一行或多行
4897	-----      启用角色分离
4898	-----      证书服务加载了一个模板
4899	-----      证书服务模板已更新
4900	-----      证书服务模板安全性已更新
4902	-----      已创建每用户审核策略表
4904	-----      尝试注册安全事件源
4905	-----      尝试取消注册安全事件源
4906	-----      CrashOnAuditFail值已更改
4907	-----      对象的审核设置已更改
4908	-----      特殊组登录表已修改
4909	-----      TBS的本地策略设置已更改
4910	-----      TBS的组策略设置已更改
4911	-----      对象的资源属性已更改
4912	-----      每用户审核策略已更改
4913	-----      对象的中央访问策略已更改
4928	-----      建立了Active  Directory副本源命名上下文
4929	-----      已删除Active  Directory副本源命名上下文
4930	-----      已修改Active  Directory副本源命名上下文
4931	-----      已修改Active  Directory副本目标命名上下文
4932	-----      已开始同步Active  Directory命名上下文的副本
4933	-----      Active  Directory命名上下文的副本的同步已结束
4934	-----      已复制Active  Directory对象的属性
4935	-----      复制失败开始
4936	-----      复制失败结束
4937	-----      从副本中删除了一个延迟对象
4944	-----      Windows防火墙启动时，以下策略处于活动状态
4945	-----      Windows防火墙启动时列出了规则
4946	-----      已对Windows防火墙例外列表进行了更改。增加了一条规则
4947	-----      已对Windows防火墙例外列表进行了更改。规则被修改了
4948	-----      已对Windows防火墙例外列表进行了更改。规则已删除
4949	-----      Windows防火墙设置已恢复为默认值
4950	-----      Windows防火墙设置已更改
4951	-----      规则已被忽略，因为Windows防火墙无法识别其主要版本号
4952	-----      已忽略规则的某些部分，因为Windows防火墙无法识别其次要版本号
4953	-----      Windows防火墙已忽略规则，因为它无法解析规则
4954	-----      Windows防火墙组策略设置已更改。已应用新设置
4956	-----      Windows防火墙已更改活动配置文件
4957	-----      Windows防火墙未应用以下规则
4958	-----      Windows防火墙未应用以下规则，因为该规则引用了此计算机上未配置的项目
4960	-----      IPsec丢弃了未通过完整性检查的入站数据包
4961	-----      IPsec丢弃了重放检查失败的入站数据包
4962	-----      IPsec丢弃了重放检查失败的入站数据包
4963	-----      IPsec丢弃了应该受到保护的入站明文数据包
4964	-----      特殊组已分配给新登录
4965	-----      IPsec从远程计算机收到一个包含不正确的安全参数索引（SPI）的数据包。
4976	-----      在主模式协商期间，IPsec收到无效的协商数据包。
4977	-----      在快速模式协商期间，IPsec收到无效的协商数据包。
4978	-----      在扩展模式协商期间，IPsec收到无效的协商数据包。
4979	-----      建立了IPsec主模式和扩展模式安全关联。
4980	-----      建立了IPsec主模式和扩展模式安全关联
4981	-----      建立了IPsec主模式和扩展模式安全关联
4982	-----      建立了IPsec主模式和扩展模式安全关联
4983	-----      IPsec扩展模式协商失败
4984	-----      IPsec扩展模式协商失败
4985	-----      交易状态已发生变化
5024	-----      Windows防火墙服务已成功启动
5025	-----      Windows防火墙服务已停止
5027	-----      Windows防火墙服务无法从本地存储中检索安全策略
5028	-----      Windows防火墙服务无法解析新的安全策略。
5029	-----      Windows防火墙服务无法初始化驱动程序
5030	-----      Windows防火墙服务无法启动
5031	-----      Windows防火墙服务阻止应用程序接受网络上的传入连接。
5032	-----      Windows防火墙无法通知用户它阻止应用程序接受网络上的传入连接
5033	-----      Windows防火墙驱动程序已成功启动
5034	-----      Windows防火墙驱动程序已停止
5035	-----      Windows防火墙驱动程序无法启动
5037	-----      Windows防火墙驱动程序检测到严重的运行时错 终止
5038	-----      代码完整性确定文件的图像哈希无效
5039	-----      注册表项已虚拟化。
5040	-----      已对IPsec设置进行了更改。添加了身份验证集。
5041	-----      已对IPsec设置进行了更改。身份验证集已修改
5042	-----      已对IPsec设置进行了更改。身份验证集已删除
5043	-----      已对IPsec设置进行了更改。添加了连接安全规则
5044	-----      已对IPsec设置进行了更改。连接安全规则已修改
5045	-----      已对IPsec设置进行了更改。连接安全规则已删除
5046	-----      已对IPsec设置进行了更改。添加了加密集
5047	-----      已对IPsec设置进行了更改。加密集已被修改
5048	-----      已对IPsec设置进行了更改。加密集已删除
5049	-----      IPsec安全关联已删除
5050	-----      尝试使用对INetFwProfile.FirewallEnabled的调用以编程方式禁用Windows防火墙（FALSE
5051	-----      文件已虚拟化
5056	-----      进行了密码自检
5057	-----      加密原语操作失败
5058	-----      密钥文件操作
5059	-----      密钥迁移操作
5060	-----      验证操作失败
5061	-----      加密操作
5062	-----      进行了内核模式加密自检
5063	-----      尝试了加密提供程序操作
5064	-----      尝试了加密上下文操作
5065	-----      尝试了加密上下文修改
5066	-----      尝试了加密功能操作
5067	-----      尝试了加密功能修改
5068	-----      尝试了加密函数提供程序操作
5069	-----      尝试了加密函数属性操作
5070	-----      尝试了加密函数属性操作
5071	-----      Microsoft密钥分发服务拒绝密钥访问
5120	-----      OCSP响应程序服务已启动
5121	-----      OCSP响应程序服务已停止
5122	-----      OCSP响应程序服务中的配置条目已更改
5123	-----      OCSP响应程序服务中的配置条目已更改
5124	-----      在OCSP  Responder Service上更新了安全设置
5125	-----      请求已提交给OCSP  Responder Service
5126	-----      签名证书由OCSP  Responder Service自动更新
5127	-----      OCSP吊销提供商成功更新了吊销信息
5136	-----      目录服务对象已修改
5137	-----      已创建目录服务对象
5138	-----      目录服务对象已取消删除
5139	-----      已移动目录服务对象
5140	-----      访问了网络共享对象
5141	-----      目录服务对象已删除
5142	-----      添加了网络共享对象。
5143	-----      网络共享对象已被修改
5144	-----      网络共享对象已删除。
5145	-----      检查网络共享对象以查看是否可以向客户端授予所需的访问权限
5146	-----      Windows筛选平台已阻止数据包
5147	-----      限制性更强的Windows筛选平台筛选器阻止了数据包
5148	-----      Windows过滤平台检测到DoS攻击并进入防御模式; 与此攻击相关的数据包将被丢弃。
5149	-----      DoS攻击已经消退，正常处理正在恢复。
5150	-----      Windows筛选平台已阻止数据包。
5151	-----      限制性更强的Windows筛选平台筛选器阻止了数据包。
5152	-----      Windows筛选平台阻止了数据包
5153	-----      限制性更强的Windows筛选平台筛选器阻止了数据包
5154	-----      Windows过滤平台允许应用程序或服务在端口上侦听传入连接
5155	-----      Windows筛选平台已阻止应用程序或服务侦听端口上的传入连接
5156	-----      Windows筛选平台允许连接
5157	-----      Windows筛选平台已阻止连接
5158	-----      Windows筛选平台允许绑定到本地端口
5159	-----      Windows筛选平台已阻止绑定到本地端口
5168	-----      SMB  / SMB2的Spn检查失败。
5169	-----      目录服务对象已修改
5170	-----      在后台清理任务期间修改了目录服务对象
5376	-----      已备份凭据管理器凭据
5377	-----      Credential  Manager凭据已从备份还原
5378	-----      策略不允许请求的凭据委派
5440	-----      Windows筛选平台基本筛选引擎启动时出现以下callout
5441	-----      Windows筛选平台基本筛选引擎启动时存在以下筛选器
5442	-----      Windows筛选平台基本筛选引擎启动时，存在以下提供程序
5443	-----      Windows筛选平台基本筛选引擎启动时，存在以下提供程序上下文
5444	-----      Windows筛选平台基本筛选引擎启动时，存在以下子层
5446	-----      Windows筛选平台标注已更改
5447	-----      Windows筛选平台筛选器已更改
5448	-----      Windows筛选平台提供程序已更改
5449	-----      Windows筛选平台提供程序上下文已更改
5450	-----      Windows筛选平台子层已更改
5451	-----      建立了IPsec快速模式安全关联
5452	-----      IPsec快速模式安全关联已结束
5453	-----      与远程计算机的IPsec协商失败，因为未启动IKE和AuthIP  IPsec密钥模块（IKEEXT）服务
5456	-----      PAStore引擎在计算机上应用了Active  Directory存储IPsec策略
5457	-----      PAStore引擎无法在计算机上应用Active  Directory存储IPsec策略
5458	-----      PAStore引擎在计算机上应用了Active  Directory存储IPsec策略的本地缓存副本
5459	-----      PAStore引擎无法在计算机上应用Active  Directory存储IPsec策略的本地缓存副本
5460	-----      PAStore引擎在计算机上应用了本地注册表存储IPsec策略
5461	-----      PAStore引擎无法在计算机上应用本地注册表存储IPsec策略
5462	-----      PAStore引擎无法在计算机上应用某些活动IPsec策略规则
5463	-----      PAStore引擎轮询活动IPsec策略的更改并检测不到任何更改
5464	-----      PAStore引擎轮询活动IPsec策略的更改，检测到更改并将其应用于IPsec服务
5465	-----      PAStore Engine收到强制重新加载IPsec策略的控件并成功处理控件
5466	-----      PAStore引擎轮询Active  Directory IPsec策略的更改，确定无法访问Active Directory，并将使用Active Directory
IPsec策略的缓存副本
5467	-----      PAStore引擎轮询Active Directory IPsec策略的更改，确定可以访问Active Directory，并且未找到对策略的更改
5468	-----      PAStore引擎轮询Active Directory IPsec策略的更改，确定可以访问Active Directory，找到策略更改并应用这些更改
5471	-----      PAStore引擎在计算机上加载了本地存储IPsec策略
5472	-----      PAStore引擎无法在计算机上加载本地存储IPsec策略
5473	-----      PAStore引擎在计算机上加载了目录存储IPsec策略
5474	-----      PAStore引擎无法在计算机上加载目录存储IPsec策略
5477	-----      PAStore引擎无法添加快速模式过滤器
5478	-----      IPsec服务已成功启动
5479	-----      IPsec服务已成功关闭
5480	-----      IPsec服务无法获取计算机上的完整网络接口列表
5483	-----      IPsec服务无法初始化RPC服务器。无法启动IPsec服务
5484	-----      IPsec服务遇到严重故障并已关闭
5485	-----      IPsec服务无法在网络接口的即插即用事件上处理某些IPsec筛选器
5632	-----      已请求对无线网络进行身份验证
5633	-----      已请求对有线网络进行身份验证
5712	-----      尝试了远程过程调用（RPC）
5888	-----      COM +目录中的对象已被修改
5889	-----      从COM +目录中删除了一个对象
5890	-----      一个对象已添加到COM +目录中
6144	-----      组策略对象中的安全策略已成功应用
6145	-----      处理组策略对象中的安全策略时发生一个或多个错误
6272	-----      网络策略服务器授予用户访问权限
6273	-----      网络策略服务器拒绝访问用户
6274	-----      网络策略服务器放弃了对用户的请求
6275	-----      网络策略服务器放弃了用户的记帐请求
6276	-----      网络策略服务器隔离了用户
6277	-----      网络策略服务器授予用户访问权限，但由于主机未满足定义的健康策略而将其置于试用期
6278	-----      网络策略服务器授予用户完全访问权限，因为主机符合定义的健康策略
6279	-----      由于重复失败的身份验证尝试，网络策略服务器锁定了用户帐户
6280	-----      网络策略服务器解锁了用户帐户
6281	-----      代码完整性确定图像文件的页面哈希值无效...
6400	-----      BranchCache：在发现内容可用性时收到格式错误的响应。
6401	-----      BranchCache：从对等方收到无效数据。数据被丢弃。
6402	-----      BranchCache：提供数据的托管缓存的消息格式不正确。
6403	-----      BranchCache：托管缓存发送了对客户端消息的错误格式化响应以提供数据。
6404	-----      BranchCache：无法使用配置的SSL证书对托管缓存进行身份验证。
6405	-----      BranchCache：发生了事件ID％1的％2个实例。
6406	-----      ％1注册到Windows防火墙以控制以下过滤：
6408	-----      已注册的产品％1失败，Windows防火墙现在正在控制％2的过滤。
6409	-----      BranchCache：无法解析服务连接点对象
6410	-----      代码完整性确定文件不满足加载到进程中的安全性要求。这可能是由于使用共享部分或其他问题
6416	-----      系统识别出新的外部设备。
6417	-----      FIPS模式加密自检成功
6418	-----      FIPS模式加密自检失败
6419	-----      发出了禁用设备的请求
6420	-----      设备已禁用
6421	-----      已发出请求以启用设备
6422	-----      设备已启用
6423	-----      系统策略禁止安装此设备
6424	-----      在事先被政策禁止之后，允许安装此设备
8191	-----      最高系统定义的审计消息值
```

---

## 9.2 日志查询

> 暴力破解账密日志 

攻击者通过暴力破解的方式入侵系统，不论是否成功，在日志中会留下入侵痕迹，所以事件id为4624和 4625的事件是首当其冲的关注点。需要留意日志中的SubjectUserNameIpAddress。 

> 账号管理日志

Windows中日志中与账号创建有关的事件ID：4720, 4722, 4724,4738。攻击者攻陷一台Windows 主机后，可能会创建后门账号、隐藏账号。 

> 新增aaaa$后门账号 

发现攻击者创建了后门账号。据此时间点可确定在这之前使用某手段或利用某漏洞获取了服务器权限， 可进一步在其他安全设备上查找该时间点前针对失陷服务器的攻击告警事件确定攻击方式。

> 远程桌面登录日志 

上述的安全日志很可能被覆盖掉，为尽量不遗漏入侵痕迹，可进一步查看远程桌面的登录日志。攻击者 建立后门账号后会通过远程桌面连接到失陷主机上，此时的登录行为会记录到远程桌面日志。

 远程连接日志（应用程序和服务日志->Microsoft->Windows->-TerminalServices- >RemoteConnectionManager->Operational），

重要事件 ID 和含义： 

```txt
1149：用户认证成功     
21：远程桌面服务：会话登录成功    
24：远程桌面服务：会话已断开连接 
25：远程桌面服务：会话重新连接成功
```

---

> 日志查询步骤

1.导出日志

<img src="https://typora-picgo-push.oss-cn-hangzhou.aliyuncs.com/img-for-typora/image-20240306135501953.png" alt="image-20240306135501953" style="zoom:50%;" />

2.使用第三方工具



# ############################

# 10.备份

> 备份分类：

完整备份：所选数据全部备份，耗时长；

增量备份：只备份有改动的数据，备份速度快；

自定义备份：针对不同磁盘选择不同方式；

---

